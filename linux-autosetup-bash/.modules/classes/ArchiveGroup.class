# Credit to Maxim Norin https://github.com/mnorin
# for OOP emulation base from https://stackoverflow.com/questions/36771080/creating-classes-and-objects-using-bash-scripting#comment115718570_40981277
# Modified by Aurtzy

# Class named "ArchiveGroup" for bash object

# fields
declare -Ag fields

# Handles getting/setting fields.
ArchiveGroup.field() {
	if [ "$2" == "=" ]; then
		fields[$1]=$3
	else
		echo ${fields[$1]}
	fi
}

# ArchiveGroup class constructor
# Params: apps to add
ArchiveGroup.constructor() {
	ArchiveGroup.add "${@}"
}

# Getter/setter methods
ArchiveGroup.archives() {
	ArchiveGroup.field archives "$1" "$2"
}
# Display archive group info
ArchiveGroup.info() {
	echo "ARCHIVE GROUP NAME:"
	echo "    ArchiveGroup"
	echo "ARCHIVE LIST:"
	for archive in $(ArchiveGroup.archives); do
		echo "    $archive"
	done
}
# Add app to apps field
ArchiveGroup.add() {
	for object in "${@}"; do
		if [[ ! " ${archives[*]} " =~ " ${object} " && ! " ${!archiveGroups[*]} " =~ " ${object} " ]]; then
			echo
			echo "ArchiveGroup: Error: Object '$object' was not found"
			echo "An object must exist before it can be added to an archive group."
			echo "Please check your config and resolve."
			echo "Exiting..."
			exit 1
		fi
		if [ "$ArchiveGroup.archives" != '' ]; then
			ArchiveGroup.archives = "$(ArchiveGroup.archives) $object"
		else
			ArchiveGroup.archives = "$object"
		fi
	done
}

# Install ArchiveGroup on call
ArchiveGroup.install() {
	echo
	echo
	echo "ArchiveGroup: Installing from archive group..."
	for archive in $(ArchiveGroup.archives); do
		$archive.install
	done
	echo
	echo "ArchiveGroup: Installation completed!"
}

# Create archives
ArchiveGroup.backup() {
	echo
	echo
	echo "ArchiveGroup: Creating archives from archive group..."
	for archive in $(ArchiveGroup.archives); do
		$archive.backup
	done
	echo
	echo "ArchiveGroup: Backup completed!"
}

